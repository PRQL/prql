---
source: src/compiler.rs
assertion_line: 283
expression: "ast.replace_variables(&mut HashMap::new())"

---
Pipeline:
  - From:
      - Ident: employees
  - Filter:
      - Ident: country
      - Raw: "="
      - String: USA
  - Derive:
      - lvalue: gross_salary
        rvalue:
          Items:
            - Ident: salary
            - Raw: +
            - Ident: payroll_tax
      - lvalue: gross_cost
        rvalue:
          Items:
            - Items:
                - Ident: salary
                - Raw: +
                - Ident: payroll_tax
            - Raw: +
            - Ident: benefits_cost
  - Filter:
      - Items:
          - Items:
              - Ident: salary
              - Raw: +
              - Ident: payroll_tax
          - Raw: +
          - Ident: benefits_cost
      - Raw: ">"
      - Raw: "0"
  - Aggregate:
      by:
        - Ident: title
        - Ident: country
      calcs:
        - Custom:
            name: average
            args:
              - Ident: salary
            named_args: []
        - Custom:
            name: sum
            args:
              - Ident: salary
            named_args: []
        - Custom:
            name: average
            args:
              - Items:
                  - Ident: salary
                  - Raw: +
                  - Ident: payroll_tax
            named_args: []
        - Custom:
            name: sum
            args:
              - Items:
                  - Ident: salary
                  - Raw: +
                  - Ident: payroll_tax
            named_args: []
        - Custom:
            name: average
            args:
              - Items:
                  - Items:
                      - Ident: salary
                      - Raw: +
                      - Ident: payroll_tax
                  - Raw: +
                  - Ident: benefits_cost
            named_args: []
      assigns:
        - lvalue: sum_gross_cost
          rvalue:
            Transformation:
              Custom:
                name: sum
                args:
                  - Items:
                      - Items:
                          - Ident: salary
                          - Raw: +
                          - Ident: payroll_tax
                      - Raw: +
                      - Ident: benefits_cost
                named_args: []
        - lvalue: count
          rvalue:
            Transformation:
              Custom:
                name: count
                args: []
                named_args: []
  - Sort:
      - Ident: sum_gross_cost
  - Filter:
      - Ident: sum_gross_cost
      - Raw: ">"
      - Raw: "200"
  - Take: 20

