---
source: src/compiler.rs
assertion_line: 356
expression: "&fold.fold_item(ast).unwrap()"

---
Query:
  - Pipeline:
      - From:
          - Ident: employees
      - Filter:
          - Expr:
              - Items:
                  - Ident: country
              - Raw: "="
              - Items:
                  - String: USA
      - Derive:
          - lvalue: gross_salary
            rvalue:
              Items:
                - Items:
                    - Ident: salary
                - Raw: +
                - Items:
                    - Ident: payroll_tax
          - lvalue: gross_cost
            rvalue:
              Items:
                - Items:
                    - Items:
                        - Items:
                            - Ident: salary
                        - Raw: +
                        - Items:
                            - Ident: payroll_tax
                - Raw: +
                - Items:
                    - Ident: benefits_cost
      - Filter:
          - Expr:
              - Items:
                  - Items:
                      - Items:
                          - Items:
                              - Items:
                                  - Ident: salary
                              - Raw: +
                              - Items:
                                  - Ident: payroll_tax
                      - Raw: +
                      - Items:
                          - Ident: benefits_cost
              - Raw: ">"
              - Items:
                  - Raw: "0"
      - Aggregate:
          by: []
          calcs:
            - NamedArg:
                name: by
                arg:
                  List:
                    - Expr:
                        - Items:
                            - Ident: title
                    - Expr:
                        - Items:
                            - Ident: country
            - List:
                - Expr:
                    - Items:
                        - Ident: average
                        - Ident: salary
                - Expr:
                    - Items:
                        - Ident: sum
                        - Ident: salary
                - Expr:
                    - Items:
                        - Ident: average
                        - Items:
                            - Items:
                                - Ident: salary
                            - Raw: +
                            - Items:
                                - Ident: payroll_tax
                - Expr:
                    - Items:
                        - Ident: sum
                        - Items:
                            - Items:
                                - Ident: salary
                            - Raw: +
                            - Items:
                                - Ident: payroll_tax
                - Expr:
                    - Items:
                        - Ident: average
                        - Items:
                            - Items:
                                - Items:
                                    - Items:
                                        - Ident: salary
                                    - Raw: +
                                    - Items:
                                        - Ident: payroll_tax
                            - Raw: +
                            - Items:
                                - Ident: benefits_cost
                - Expr:
                    - Items:
                        - Assign:
                            lvalue: sum_gross_cost
                            rvalue:
                              Items:
                                - Ident: sum
                                - Items:
                                    - Items:
                                        - Items:
                                            - Items:
                                                - Ident: salary
                                            - Raw: +
                                            - Items:
                                                - Ident: payroll_tax
                                    - Raw: +
                                    - Items:
                                        - Ident: benefits_cost
                - Expr:
                    - Items:
                        - Assign:
                            lvalue: count
                            rvalue:
                              Ident: count
          assigns: []
      - Sort:
          - Items:
              - Ident: sum
              - Items:
                  - Items:
                      - Items:
                          - Items:
                              - Ident: salary
                          - Raw: +
                          - Items:
                              - Ident: payroll_tax
                  - Raw: +
                  - Items:
                      - Ident: benefits_cost
      - Filter:
          - Expr:
              - Items:
                  - Items:
                      - Ident: sum
                      - Items:
                          - Items:
                              - Items:
                                  - Items:
                                      - Ident: salary
                                  - Raw: +
                                  - Items:
                                      - Ident: payroll_tax
                          - Raw: +
                          - Items:
                              - Ident: benefits_cost
              - Raw: ">"
              - Items:
                  - Raw: "200"
      - Take: 20

