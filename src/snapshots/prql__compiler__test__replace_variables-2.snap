---
source: src/compiler.rs
assertion_line: 357
expression: "&fold.fold_item(ast).unwrap()"

---
Query:
  - Pipeline:
      - From:
          - Ident: employees
      - Filter:
          - Ident: country
          - Raw: "="
          - String: USA
      - Derive:
          - lvalue: gross_salary
            rvalue:
              Items:
                - Ident: salary
                - Raw: +
                - Ident: payroll_tax
          - lvalue: gross_cost
            rvalue:
              Items:
                - Items:
                    - Ident: salary
                    - Raw: +
                    - Ident: payroll_tax
                - Raw: +
                - Ident: benefits_cost
      - Filter:
          - Items:
              - Items:
                  - Ident: salary
                  - Raw: +
                  - Ident: payroll_tax
              - Raw: +
              - Ident: benefits_cost
          - Raw: ">"
          - Raw: "0"
      - Aggregate:
          by:
            - Ident: title
            - Ident: country
          calcs:
            - Transformation:
                Func:
                  name: average
                  args:
                    - Ident: salary
                  named_args: []
            - Transformation:
                Func:
                  name: sum
                  args:
                    - Ident: salary
                  named_args: []
            - Transformation:
                Func:
                  name: average
                  args:
                    - Items:
                        - Ident: salary
                        - Raw: +
                        - Ident: payroll_tax
                  named_args: []
            - Transformation:
                Func:
                  name: sum
                  args:
                    - Items:
                        - Ident: salary
                        - Raw: +
                        - Ident: payroll_tax
                  named_args: []
            - Transformation:
                Func:
                  name: average
                  args:
                    - Items:
                        - Items:
                            - Ident: salary
                            - Raw: +
                            - Ident: payroll_tax
                        - Raw: +
                        - Ident: benefits_cost
                  named_args: []
          assigns:
            - lvalue: sum_gross_cost
              rvalue:
                Transformation:
                  Func:
                    name: sum
                    args:
                      - Items:
                          - Items:
                              - Ident: salary
                              - Raw: +
                              - Ident: payroll_tax
                          - Raw: +
                          - Ident: benefits_cost
                    named_args: []
            - lvalue: count
              rvalue:
                Transformation:
                  Func:
                    name: count
                    args: []
                    named_args: []
      - Sort:
          - Transformation:
              Func:
                name: sum
                args:
                  - Items:
                      - Items:
                          - Ident: salary
                          - Raw: +
                          - Ident: payroll_tax
                      - Raw: +
                      - Ident: benefits_cost
                named_args: []
      - Filter:
          - Transformation:
              Func:
                name: sum
                args:
                  - Items:
                      - Items:
                          - Ident: salary
                          - Raw: +
                          - Ident: payroll_tax
                      - Raw: +
                      - Ident: benefits_cost
                named_args: []
          - Raw: ">"
          - Raw: "200"
      - Take: 20

