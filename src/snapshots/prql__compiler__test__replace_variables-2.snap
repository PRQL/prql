---
source: src/compiler.rs
assertion_line: 256
expression: "ast.replace_variables(&mut HashMap::new())"

---
Pipeline:
  - From:
      - Ident: employees
  - Filter:
      - Ident: country
      - Raw: "="
      - String: "\"USA\""
  - Derive:
      - lvalue: gross_salary
        rvalue:
          - Ident: salary
          - Raw: +
          - Ident: payroll_tax
      - lvalue: gross_cost
        rvalue:
          - Items:
              - Ident: salary
              - Raw: +
              - Ident: payroll_tax
          - Raw: +
          - Ident: benefits_cost
  - Filter:
      - Items:
          - Items:
              - Ident: salary
              - Raw: +
              - Ident: payroll_tax
          - Raw: +
          - Ident: benefits_cost
      - Raw: ">"
      - Raw: "0"
  - Aggregate:
      by:
        - List:
            - Ident: title
            - Ident: country
      calcs:
        - List:
            - Items:
                - Ident: average
                - Ident: salary
            - Items:
                - Ident: sum
                - Ident: salary
            - Items:
                - Ident: average
                - Items:
                    - Ident: salary
                    - Raw: +
                    - Ident: payroll_tax
            - Items:
                - Ident: sum
                - Items:
                    - Ident: salary
                    - Raw: +
                    - Ident: payroll_tax
            - Items:
                - Ident: average
                - Items:
                    - Items:
                        - Ident: salary
                        - Raw: +
                        - Ident: payroll_tax
                    - Raw: +
                    - Ident: benefits_cost
            - Assign:
                lvalue: sum_gross_cost
                rvalue:
                  - Ident: sum
                  - Items:
                      - Items:
                          - Ident: salary
                          - Raw: +
                          - Ident: payroll_tax
                      - Raw: +
                      - Ident: benefits_cost
            - Ident: count
  - Sort:
      - Ident: sum_gross_cost
  - Filter:
      - Ident: count
      - Raw: ">"
      - Raw: "200"
  - Take: 20

