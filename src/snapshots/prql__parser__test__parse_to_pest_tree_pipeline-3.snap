---
source: src/parser.rs
assertion_line: 655
expression: "parse_to_pest_tree(r#\"\nfrom employees\nfilter country = \"USA\"                           # Each line transforms the previous result.\nderive [                                         # This adds columns / variables.\n  gross_salary: salary + payroll_tax,\n  gross_cost:   gross_salary + benefits_cost     # Variables can use other variables.\n]\nfilter gross_cost > 0\naggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost: sum gross_cost,\n    count: count,\n]\nsort sum_gross_cost\nfilter count > 200\ntake 20\n    \"#.trim(),\n    Rule::pipeline)"

---
Ok(
    [
        Pair {
            rule: pipeline,
            span: Span {
                str: "from employees\nfilter country = \"USA\"                           # Each line transforms the previous result.\nderive [                                         # This adds columns / variables.\n  gross_salary: salary + payroll_tax,\n  gross_cost:   gross_salary + benefits_cost     # Variables can use other variables.\n]\nfilter gross_cost > 0\naggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost: sum gross_cost,\n    count: count,\n]\nsort sum_gross_cost\nfilter count > 200\ntake 20",
                start: 0,
                end: 719,
            },
            inner: [
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "from employees",
                        start: 0,
                        end: 14,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "from",
                                start: 0,
                                end: 4,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "employees",
                                start: 5,
                                end: 14,
                            },
                            inner: [],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "filter country = \"USA\"",
                        start: 15,
                        end: 37,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "filter",
                                start: 15,
                                end: 21,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "country",
                                start: 22,
                                end: 29,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: operator,
                            span: Span {
                                str: "=",
                                start: 30,
                                end: 31,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: string_literal,
                            span: Span {
                                str: "\"USA\"",
                                start: 32,
                                end: 37,
                            },
                            inner: [
                                Pair {
                                    rule: string,
                                    span: Span {
                                        str: "USA",
                                        start: 33,
                                        end: 36,
                                    },
                                    inner: [],
                                },
                            ],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "derive [                                         # This adds columns / variables.\n  gross_salary: salary + payroll_tax,\n  gross_cost:   gross_salary + benefits_cost     # Variables can use other variables.\n]",
                        start: 108,
                        end: 315,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "derive",
                                start: 108,
                                end: 114,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: list,
                            span: Span {
                                str: "[                                         # This adds columns / variables.\n  gross_salary: salary + payroll_tax,\n  gross_cost:   gross_salary + benefits_cost     # Variables can use other variables.\n]",
                                start: 115,
                                end: 315,
                            },
                            inner: [
                                Pair {
                                    rule: assign,
                                    span: Span {
                                        str: "gross_salary: salary + payroll_tax",
                                        start: 192,
                                        end: 226,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "gross_salary",
                                                start: 192,
                                                end: 204,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: items,
                                            span: Span {
                                                str: "salary + payroll_tax",
                                                start: 206,
                                                end: 226,
                                            },
                                            inner: [
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "salary",
                                                        start: 206,
                                                        end: 212,
                                                    },
                                                    inner: [],
                                                },
                                                Pair {
                                                    rule: operator,
                                                    span: Span {
                                                        str: "+",
                                                        start: 213,
                                                        end: 214,
                                                    },
                                                    inner: [],
                                                },
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "payroll_tax",
                                                        start: 215,
                                                        end: 226,
                                                    },
                                                    inner: [],
                                                },
                                            ],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: assign,
                                    span: Span {
                                        str: "gross_cost:   gross_salary + benefits_cost",
                                        start: 230,
                                        end: 272,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "gross_cost",
                                                start: 230,
                                                end: 240,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: items,
                                            span: Span {
                                                str: "gross_salary + benefits_cost",
                                                start: 244,
                                                end: 272,
                                            },
                                            inner: [
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "gross_salary",
                                                        start: 244,
                                                        end: 256,
                                                    },
                                                    inner: [],
                                                },
                                                Pair {
                                                    rule: operator,
                                                    span: Span {
                                                        str: "+",
                                                        start: 257,
                                                        end: 258,
                                                    },
                                                    inner: [],
                                                },
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "benefits_cost",
                                                        start: 259,
                                                        end: 272,
                                                    },
                                                    inner: [],
                                                },
                                            ],
                                        },
                                    ],
                                },
                            ],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "filter gross_cost > 0",
                        start: 316,
                        end: 337,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "filter",
                                start: 316,
                                end: 322,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "gross_cost",
                                start: 323,
                                end: 333,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: operator,
                            span: Span {
                                str: ">",
                                start: 334,
                                end: 335,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: number,
                            span: Span {
                                str: "0",
                                start: 336,
                                end: 337,
                            },
                            inner: [],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "aggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost: sum gross_cost,\n    count: count,\n]",
                        start: 338,
                        end: 672,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "aggregate",
                                start: 338,
                                end: 347,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: named_arg,
                            span: Span {
                                str: "by:[title, country]",
                                start: 348,
                                end: 367,
                            },
                            inner: [
                                Pair {
                                    rule: ident,
                                    span: Span {
                                        str: "by",
                                        start: 348,
                                        end: 350,
                                    },
                                    inner: [],
                                },
                                Pair {
                                    rule: list,
                                    span: Span {
                                        str: "[title, country]",
                                        start: 351,
                                        end: 367,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "title",
                                                start: 352,
                                                end: 357,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "country",
                                                start: 359,
                                                end: 366,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                            ],
                        },
                        Pair {
                            rule: list,
                            span: Span {
                                str: "[                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost: sum gross_cost,\n    count: count,\n]",
                                start: 368,
                                end: 672,
                            },
                            inner: [
                                Pair {
                                    rule: items,
                                    span: Span {
                                        str: "average salary",
                                        start: 427,
                                        end: 441,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "average",
                                                start: 427,
                                                end: 434,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "salary",
                                                start: 435,
                                                end: 441,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: items,
                                    span: Span {
                                        str: "sum     salary",
                                        start: 525,
                                        end: 539,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "sum",
                                                start: 525,
                                                end: 528,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "salary",
                                                start: 533,
                                                end: 539,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: items,
                                    span: Span {
                                        str: "average gross_salary",
                                        start: 545,
                                        end: 565,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "average",
                                                start: 545,
                                                end: 552,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "gross_salary",
                                                start: 553,
                                                end: 565,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: items,
                                    span: Span {
                                        str: "sum     gross_salary",
                                        start: 571,
                                        end: 591,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "sum",
                                                start: 571,
                                                end: 574,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "gross_salary",
                                                start: 579,
                                                end: 591,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: items,
                                    span: Span {
                                        str: "average gross_cost",
                                        start: 597,
                                        end: 615,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "average",
                                                start: 597,
                                                end: 604,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "gross_cost",
                                                start: 605,
                                                end: 615,
                                            },
                                            inner: [],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: assign,
                                    span: Span {
                                        str: "sum_gross_cost: sum gross_cost",
                                        start: 621,
                                        end: 651,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "sum_gross_cost",
                                                start: 621,
                                                end: 635,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: items,
                                            span: Span {
                                                str: "sum gross_cost",
                                                start: 637,
                                                end: 651,
                                            },
                                            inner: [
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "sum",
                                                        start: 637,
                                                        end: 640,
                                                    },
                                                    inner: [],
                                                },
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "gross_cost",
                                                        start: 641,
                                                        end: 651,
                                                    },
                                                    inner: [],
                                                },
                                            ],
                                        },
                                    ],
                                },
                                Pair {
                                    rule: assign,
                                    span: Span {
                                        str: "count: count",
                                        start: 657,
                                        end: 669,
                                    },
                                    inner: [
                                        Pair {
                                            rule: ident,
                                            span: Span {
                                                str: "count",
                                                start: 657,
                                                end: 662,
                                            },
                                            inner: [],
                                        },
                                        Pair {
                                            rule: items,
                                            span: Span {
                                                str: "count",
                                                start: 664,
                                                end: 669,
                                            },
                                            inner: [
                                                Pair {
                                                    rule: ident,
                                                    span: Span {
                                                        str: "count",
                                                        start: 664,
                                                        end: 669,
                                                    },
                                                    inner: [],
                                                },
                                            ],
                                        },
                                    ],
                                },
                            ],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "sort sum_gross_cost",
                        start: 673,
                        end: 692,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "sort",
                                start: 673,
                                end: 677,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "sum_gross_cost",
                                start: 678,
                                end: 692,
                            },
                            inner: [],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "filter count > 200",
                        start: 693,
                        end: 711,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "filter",
                                start: 693,
                                end: 699,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "count",
                                start: 700,
                                end: 705,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: operator,
                            span: Span {
                                str: ">",
                                start: 706,
                                end: 707,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: number,
                            span: Span {
                                str: "200",
                                start: 708,
                                end: 711,
                            },
                            inner: [],
                        },
                    ],
                },
                Pair {
                    rule: transformation,
                    span: Span {
                        str: "take 20",
                        start: 712,
                        end: 719,
                    },
                    inner: [
                        Pair {
                            rule: ident,
                            span: Span {
                                str: "take",
                                start: 712,
                                end: 716,
                            },
                            inner: [],
                        },
                        Pair {
                            rule: number,
                            span: Span {
                                str: "20",
                                start: 717,
                                end: 719,
                            },
                            inner: [],
                        },
                    ],
                },
            ],
        },
    ],
)
