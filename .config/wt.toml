# Worktrunk configuration for PRQL
#
# Available template variables:
#   {{ repo }}      - Repository name
#   {{ branch }}    - Branch name (slashes replaced with dashes)
#   {{ worktree }}  - Path to the new worktree
#   {{ repo_root }} - Path to the main repository root

# Post-start commands run in parallel after switching to a worktree
[post-start]
# Seed compiled dependencies from main worktree using CoW (copy-on-write)
# Copies essential files, skipping incremental build objects
# Result: warm-start builds instead of cold compiles
# macOS: uses cp -c (clonefile on APFS)
deps = """
[ -d {{ repo_path }}/target/debug/deps ] && [ ! -e target ] &&
mkdir -p target/debug/deps &&
cp -c {{ repo_path }}/target/debug/deps/*.rlib {{ repo_path }}/target/debug/deps/*.rmeta target/debug/deps/ &&
cp -cR {{ repo_path }}/target/debug/.fingerprint {{ repo_path }}/target/debug/build target/debug/
"""
