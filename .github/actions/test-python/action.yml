name: cargo-test
description: Runs cargo test & cargo lint for a given platform & target.

inputs:
  target:
    description: "Target triple, like `wasm32-unknown-unknown"
    required: false
  target_option:
    description: "--target={target}"
    required: false

runs:
  using: composite
  steps:
    - name: ðŸ”— Setup toolchain
      # If we don't get a value, then skip; we're using the default value.
      if: ${{ inputs.target }}
      uses: actions-rs/toolchain@v1
    - name: Build wheel
      uses: ./.github/actions/build-wheel
    - name: Setup nox
      uses: ./.github/actions/setup-nox
      with:
        cache_number: 0
    - name: Run tests
      run: nox -s tests -f prql-python/noxfile.py
