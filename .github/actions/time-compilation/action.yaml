name: Time Compilation
description: Time the cargo compilation, outputting an HTML file.

inputs:
  target:
    description: "Target triple, like `wasm32-unknown-unknown"
    required: false
  target_option:
    description: "--target={target}"
    required: false
  use-cache:
    required: true

runs:
  using: composite
  steps:
    - name: üîó Setup toolchain
      # If we don't get a value, then skip; we're using the default value.
      if: ${{ inputs.target }}
      uses: actions-rs/toolchain@v1
      with:
        profile: minimal
        target: ${{ inputs.target }}
        toolchain: nightly
        override: true
        default: true
    - name: cache
      uses: Swatinem/rust-cache@v1
      if: ${{ inputs.cache }}
    - name: üè≠ Compile
      uses: actions-rs/cargo@v1
      with:
        command: build
        args: --timings=html -Z unstable-options
    - uses: actions/upload-artifact@v3
      with:
        name: cargo-timing.html
        path: target/cargo-timings/*.html
        # Only upload if we didn't want to use the cache, or we got a cache hit
        if: ${{ !inputs.cache || steps.cache.outputs.cache-hit }}
