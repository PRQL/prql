name: Time Compilation
description: Time the cargo compilation, outputting an HTML file.

inputs:
  target:
    description: "Target triple, like `wasm32-unknown-unknown"
    required: false
  target_option:
    description: "--target={target}"
    required: false
  use_cache:
    required: true
    type: boolean

runs:
  using: composite
  steps:
    - name: ğŸ”— Setup toolchain
      uses: actions-rs/toolchain@v1
      with:
        profile: minimal
        target: ${{ inputs.target }}
        toolchain: nightly
        override: true
        default: true
    - name: ğŸ’° Cache
      id: cache
      uses: Swatinem/rust-cache@v1
      if: ${{ inputs.use_cache == true }}
    - name: ğŸ­ Compile
      uses: actions-rs/cargo@v1
      with:
        command: build
        args: --timings=html -Z unstable-options
    - run: |
        echo ${{ inputs.use_cache }}
        echo ${{ inputs.use_cache == 'true' }}
        echo ${{ steps.cache.outputs.cache-hit }}
      shell: bash
    - uses: actions/upload-artifact@v3
      with:
        name: cargo-timing.html
        path: target/cargo-timings/*.html
        # Only upload if we didn't want to use the cache, or we got a cache hit
      if: ${{ inputs.use_cache == false || steps.cache.outputs.cache-hit == true }}
