name: publish-snap
on:
  release:
    types: [published]
  pull_request:
    paths:
      - .github/workflows/publish-snap.yaml

jobs:
  publish-snap:
    runs-on: ubuntu-latest

    # Skip running workflow on forks
    if: github.repository_owner == 'prql'

    steps:
      - name: ðŸ“‚ Checkout code
        uses: actions/checkout@v3
      - name: ðŸ“¦ Build Snap
        uses: snapcore/action-build@v1
      - name: ðŸ†™ Publish Snap
        uses: snapcore/action-publish@v1
        env:
          SNAPCRAFT_STORE_CREDENTIALS: ${{ secrets.STORE_LOGIN }}
        with:
          snap: ${{ steps.build.outputs.snap }}
          release: edge
