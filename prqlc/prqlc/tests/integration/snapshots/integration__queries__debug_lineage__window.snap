---
source: prqlc/prqlc/tests/integration/queries.rs
expression: "# mssql:skip Conversion(\"cannot interpret I64(Some(1)) as an i32 value\")', connection.rs:200:34\n# duckdb:skip problems with DISTINCT ON (duckdb internal error: [with INPUT_TYPE = int; RESULT_TYPE = unsigned char]: Assertion `min_val <= input' failed.)\n# clickhouse:skip problems with DISTINCT ON\n# postgres:skip problems with DISTINCT ON\n# glaredb:skip â€” TODO: started raising an error on 2024-05-20, from https://github.com/PRQL/prql/actions/runs/9154902656/job/25198160283:\n    # ERROR: This feature is not implemented: Unsupported ast node in sqltorel:\n    # Substring { expr: Identifier(Ident { value: \"title\", quote_style: None }),\n    # substring_from: Some(Value(Number(\"2\", false))), substring_for:\n    # Some(Value(Number(\"5\", false))), special: true }\nfrom tracks\ngroup genre_id (\n  sort milliseconds\n  derive {\n    num = (row_number this | as SIGNED),\n    total = count this,\n    last_val = last track_id,\n  }\n  take 10\n)\nsort {genre_id, milliseconds}\nselect {track_id, genre_id, num, total, last_val}\nfilter genre_id >= 22\n"
input_file: prqlc/prqlc/tests/integration/queries/window.prql
---
frames:
- - 1:813-920
  - columns:
    - !All
      input_id: 127
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 160
      target_name: null
    - !Single
      name:
      - total
      target_id: 176
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 178
      target_name: null
    inputs:
    - id: 127
      name: tracks
      table:
      - default_db
      - tracks
- - 1:923-930
  - columns:
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 129
      target_name: null
    - !All
      input_id: 127
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 160
      target_name: null
    - !Single
      name:
      - total
      target_id: 176
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 178
      target_name: null
    inputs:
    - id: 127
      name: tracks
      table:
      - default_db
      - tracks
- - 1:933-962
  - columns:
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 129
      target_name: null
    - !All
      input_id: 127
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 160
      target_name: null
    - !Single
      name:
      - total
      target_id: 176
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 178
      target_name: null
    inputs:
    - id: 127
      name: tracks
      table:
      - default_db
      - tracks
- - 1:963-1012
  - columns:
    - !Single
      name:
      - tracks
      - track_id
      target_id: 192
      target_name: null
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 193
      target_name: null
    - !Single
      name:
      - num
      target_id: 194
      target_name: null
    - !Single
      name:
      - total
      target_id: 195
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 196
      target_name: null
    inputs:
    - id: 127
      name: tracks
      table:
      - default_db
      - tracks
- - 1:1013-1034
  - columns:
    - !Single
      name:
      - tracks
      - track_id
      target_id: 192
      target_name: null
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 193
      target_name: null
    - !Single
      name:
      - num
      target_id: 194
      target_name: null
    - !Single
      name:
      - total
      target_id: 195
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 196
      target_name: null
    inputs:
    - id: 127
      name: tracks
      table:
      - default_db
      - tracks
nodes:
- id: 127
  kind: Ident
  span: 1:762-773
  ident: !Ident
  - default_db
  - tracks
  parent: 182
- id: 129
  kind: Ident
  span: 1:780-788
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 127
  parent: 138
- id: 138
  kind: Tuple
  span: 1:780-788
  children:
  - 129
- id: 157
  kind: Ident
  span: 1:798-810
  ident: !Ident
  - this
  - tracks
  - milliseconds
  targets:
  - 127
- id: 160
  kind: RqOperator
  span: 1:851-860
  alias: num
  targets:
  - 168
  parent: 181
- id: 168
  kind: RqOperator
  span: 1:833-848
  targets:
  - 169
- id: 169
  kind: Literal
- id: 176
  kind: RqOperator
  span: 1:875-885
  alias: total
  targets:
  - 177
  parent: 181
- id: 177
  kind: Literal
- id: 178
  kind: RqOperator
  span: 1:902-915
  alias: last_val
  targets:
  - 180
  parent: 181
- id: 180
  kind: Ident
  span: 1:907-915
  ident: !Ident
  - this
  - tracks
  - track_id
  targets:
  - 127
- id: 181
  kind: Tuple
  span: 1:820-920
  children:
  - 160
  - 176
  - 178
  parent: 182
- id: 182
  kind: 'TransformCall: Derive'
  span: 1:813-920
  children:
  - 127
  - 181
  parent: 184
- id: 184
  kind: 'TransformCall: Take'
  span: 1:923-930
  children:
  - 182
  - 185
  parent: 191
- id: 185
  kind: Literal
  parent: 184
- id: 188
  kind: Ident
  span: 1:939-947
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 129
  parent: 191
- id: 189
  kind: Ident
  span: 1:949-961
  ident: !Ident
  - this
  - tracks
  - milliseconds
  targets:
  - 127
  parent: 191
- id: 191
  kind: 'TransformCall: Sort'
  span: 1:933-962
  children:
  - 184
  - 188
  - 189
  parent: 198
- id: 192
  kind: Ident
  span: 1:971-979
  ident: !Ident
  - this
  - tracks
  - track_id
  targets:
  - 127
  parent: 197
- id: 193
  kind: Ident
  span: 1:981-989
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 129
  parent: 197
- id: 194
  kind: Ident
  span: 1:991-994
  ident: !Ident
  - this
  - num
  targets:
  - 160
  parent: 197
- id: 195
  kind: Ident
  span: 1:996-1001
  ident: !Ident
  - this
  - total
  targets:
  - 176
  parent: 197
- id: 196
  kind: Ident
  span: 1:1003-1011
  ident: !Ident
  - this
  - last_val
  targets:
  - 178
  parent: 197
- id: 197
  kind: Tuple
  span: 1:970-1012
  children:
  - 192
  - 193
  - 194
  - 195
  - 196
  parent: 198
- id: 198
  kind: 'TransformCall: Select'
  span: 1:963-1012
  children:
  - 191
  - 197
  parent: 203
- id: 199
  kind: RqOperator
  span: 1:1020-1034
  targets:
  - 201
  - 202
  parent: 203
- id: 201
  kind: Ident
  span: 1:1020-1028
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 193
- id: 202
  kind: Literal
  span: 1:1032-1034
- id: 203
  kind: 'TransformCall: Filter'
  span: 1:1013-1034
  children:
  - 198
  - 199
ast:
  name: Project
  stmts:
  - VarDef:
      kind: Main
      name: main
      value:
        Pipeline:
          exprs:
          - FuncCall:
              name:
                Ident: from
                span: 1:762-766
              args:
              - Ident: tracks
                span: 1:767-773
            span: 1:762-773
          - FuncCall:
              name:
                Ident: group
                span: 1:774-779
              args:
              - Ident: genre_id
                span: 1:780-788
              - Pipeline:
                  exprs:
                  - FuncCall:
                      name:
                        Ident: sort
                        span: 1:793-797
                      args:
                      - Ident: milliseconds
                        span: 1:798-810
                    span: 1:793-810
                  - FuncCall:
                      name:
                        Ident: derive
                        span: 1:813-819
                      args:
                      - Tuple:
                        - Pipeline:
                            exprs:
                            - FuncCall:
                                name:
                                  Ident: row_number
                                  span: 1:833-843
                                args:
                                - Ident: this
                                  span: 1:844-848
                              span: 1:833-848
                            - FuncCall:
                                name:
                                  Ident: as
                                  span: 1:851-853
                                args:
                                - Ident: SIGNED
                                  span: 1:854-860
                              span: 1:851-860
                          span: 1:832-861
                          alias: num
                        - FuncCall:
                            name:
                              Ident: count
                              span: 1:875-880
                            args:
                            - Ident: this
                              span: 1:881-885
                          span: 1:875-885
                          alias: total
                        - FuncCall:
                            name:
                              Ident: last
                              span: 1:902-906
                            args:
                            - Ident: track_id
                              span: 1:907-915
                          span: 1:902-915
                          alias: last_val
                        span: 1:820-920
                    span: 1:813-920
                  - FuncCall:
                      name:
                        Ident: take
                        span: 1:923-927
                      args:
                      - Literal:
                          Integer: 10
                        span: 1:928-930
                    span: 1:923-930
                span: 1:793-930
            span: 1:774-932
          - FuncCall:
              name:
                Ident: sort
                span: 1:933-937
              args:
              - Tuple:
                - Ident: genre_id
                  span: 1:939-947
                - Ident: milliseconds
                  span: 1:949-961
                span: 1:938-962
            span: 1:933-962
          - FuncCall:
              name:
                Ident: select
                span: 1:963-969
              args:
              - Tuple:
                - Ident: track_id
                  span: 1:971-979
                - Ident: genre_id
                  span: 1:981-989
                - Ident: num
                  span: 1:991-994
                - Ident: total
                  span: 1:996-1001
                - Ident: last_val
                  span: 1:1003-1011
                span: 1:970-1012
            span: 1:963-1012
          - FuncCall:
              name:
                Ident: filter
                span: 1:1013-1019
              args:
              - Binary:
                  left:
                    Ident: genre_id
                    span: 1:1020-1028
                  op: Gte
                  right:
                    Literal:
                      Integer: 22
                    span: 1:1032-1034
                span: 1:1020-1034
            span: 1:1013-1034
        span: 1:762-1034
    span: 1:0-1034
