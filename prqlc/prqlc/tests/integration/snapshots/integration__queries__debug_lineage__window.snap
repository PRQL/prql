---
source: prqlc/prqlc/tests/integration/queries.rs
expression: "# clickhouse:skip problems with DISTINCT ON\n# glaredb:skip â€” TODO: started raising an error on 2024-05-20, from https://github.com/PRQL/prql/actions/runs/9154902656/job/25198160283:\n    # ERROR: This feature is not implemented: Unsupported ast node in sqltorel:\n    # Substring { expr: Identifier(Ident { value: \"title\", quote_style: None }),\n    # substring_from: Some(Value(Number(\"2\", false))), substring_for:\n    # Some(Value(Number(\"5\", false))), special: true }\nfrom tracks\ngroup genre_id (\n  sort milliseconds\n  derive {\n    num = row_number this,\n    total = count this,\n    last_val = last track_id,\n  }\n  take 10\n)\nsort {genre_id, milliseconds}\nselect {track_id, genre_id, num, total, last_val}\nfilter genre_id >= 22\n"
input_file: prqlc/prqlc/tests/integration/queries/window.prql
---
frames:
- - 1:521-614
  - columns:
    - !All
      input_id: 124
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 162
      target_name: null
    - !Single
      name:
      - total
      target_id: 170
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 172
      target_name: null
    inputs:
    - id: 124
      name: tracks
      table:
      - default_db
      - tracks
- - 1:617-624
  - columns:
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 126
      target_name: null
    - !All
      input_id: 124
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 162
      target_name: null
    - !Single
      name:
      - total
      target_id: 170
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 172
      target_name: null
    inputs:
    - id: 124
      name: tracks
      table:
      - default_db
      - tracks
- - 1:627-656
  - columns:
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 126
      target_name: null
    - !All
      input_id: 124
      except:
      - genre_id
    - !Single
      name:
      - num
      target_id: 162
      target_name: null
    - !Single
      name:
      - total
      target_id: 170
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 172
      target_name: null
    inputs:
    - id: 124
      name: tracks
      table:
      - default_db
      - tracks
- - 1:657-706
  - columns:
    - !Single
      name:
      - tracks
      - track_id
      target_id: 186
      target_name: null
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 187
      target_name: null
    - !Single
      name:
      - num
      target_id: 188
      target_name: null
    - !Single
      name:
      - total
      target_id: 189
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 190
      target_name: null
    inputs:
    - id: 124
      name: tracks
      table:
      - default_db
      - tracks
- - 1:707-728
  - columns:
    - !Single
      name:
      - tracks
      - track_id
      target_id: 186
      target_name: null
    - !Single
      name:
      - tracks
      - genre_id
      target_id: 187
      target_name: null
    - !Single
      name:
      - num
      target_id: 188
      target_name: null
    - !Single
      name:
      - total
      target_id: 189
      target_name: null
    - !Single
      name:
      - last_val
      target_id: 190
      target_name: null
    inputs:
    - id: 124
      name: tracks
      table:
      - default_db
      - tracks
nodes:
- id: 124
  kind: Ident
  span: 1:470-481
  ident: !Ident
  - default_db
  - tracks
  parent: 176
- id: 126
  kind: Ident
  span: 1:488-496
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 124
  parent: 135
- id: 135
  kind: Tuple
  span: 1:488-496
  children:
  - 126
- id: 154
  kind: Ident
  span: 1:506-518
  ident: !Ident
  - this
  - tracks
  - milliseconds
  targets:
  - 124
- id: 162
  kind: RqOperator
  span: 1:540-555
  alias: num
  targets:
  - 163
  parent: 175
- id: 163
  kind: Literal
- id: 170
  kind: RqOperator
  span: 1:569-579
  alias: total
  targets:
  - 171
  parent: 175
- id: 171
  kind: Literal
- id: 172
  kind: RqOperator
  span: 1:596-609
  alias: last_val
  targets:
  - 174
  parent: 175
- id: 174
  kind: Ident
  span: 1:601-609
  ident: !Ident
  - this
  - tracks
  - track_id
  targets:
  - 124
- id: 175
  kind: Tuple
  span: 1:528-614
  children:
  - 162
  - 170
  - 172
  parent: 176
- id: 176
  kind: 'TransformCall: Derive'
  span: 1:521-614
  children:
  - 124
  - 175
  parent: 178
- id: 178
  kind: 'TransformCall: Take'
  span: 1:617-624
  children:
  - 176
  - 179
  parent: 185
- id: 179
  kind: Literal
  parent: 178
- id: 182
  kind: Ident
  span: 1:633-641
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 126
  parent: 185
- id: 183
  kind: Ident
  span: 1:643-655
  ident: !Ident
  - this
  - tracks
  - milliseconds
  targets:
  - 124
  parent: 185
- id: 185
  kind: 'TransformCall: Sort'
  span: 1:627-656
  children:
  - 178
  - 182
  - 183
  parent: 192
- id: 186
  kind: Ident
  span: 1:665-673
  ident: !Ident
  - this
  - tracks
  - track_id
  targets:
  - 124
  parent: 191
- id: 187
  kind: Ident
  span: 1:675-683
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 126
  parent: 191
- id: 188
  kind: Ident
  span: 1:685-688
  ident: !Ident
  - this
  - num
  targets:
  - 162
  parent: 191
- id: 189
  kind: Ident
  span: 1:690-695
  ident: !Ident
  - this
  - total
  targets:
  - 170
  parent: 191
- id: 190
  kind: Ident
  span: 1:697-705
  ident: !Ident
  - this
  - last_val
  targets:
  - 172
  parent: 191
- id: 191
  kind: Tuple
  span: 1:664-706
  children:
  - 186
  - 187
  - 188
  - 189
  - 190
  parent: 192
- id: 192
  kind: 'TransformCall: Select'
  span: 1:657-706
  children:
  - 185
  - 191
  parent: 197
- id: 193
  kind: RqOperator
  span: 1:714-728
  targets:
  - 195
  - 196
  parent: 197
- id: 195
  kind: Ident
  span: 1:714-722
  ident: !Ident
  - this
  - tracks
  - genre_id
  targets:
  - 187
- id: 196
  kind: Literal
  span: 1:726-728
- id: 197
  kind: 'TransformCall: Filter'
  span: 1:707-728
  children:
  - 192
  - 193
ast:
  name: Project
  stmts:
  - VarDef:
      kind: Main
      name: main
      value:
        Pipeline:
          exprs:
          - FuncCall:
              name:
                Ident:
                - from
                span: 1:470-474
              args:
              - Ident:
                - tracks
                span: 1:475-481
            span: 1:470-481
          - FuncCall:
              name:
                Ident:
                - group
                span: 1:482-487
              args:
              - Ident:
                - genre_id
                span: 1:488-496
              - Pipeline:
                  exprs:
                  - FuncCall:
                      name:
                        Ident:
                        - sort
                        span: 1:501-505
                      args:
                      - Ident:
                        - milliseconds
                        span: 1:506-518
                    span: 1:501-518
                  - FuncCall:
                      name:
                        Ident:
                        - derive
                        span: 1:521-527
                      args:
                      - Tuple:
                        - FuncCall:
                            name:
                              Ident:
                              - row_number
                              span: 1:540-550
                            args:
                            - Ident:
                              - this
                              span: 1:551-555
                          span: 1:540-555
                          alias: num
                        - FuncCall:
                            name:
                              Ident:
                              - count
                              span: 1:569-574
                            args:
                            - Ident:
                              - this
                              span: 1:575-579
                          span: 1:569-579
                          alias: total
                        - FuncCall:
                            name:
                              Ident:
                              - last
                              span: 1:596-600
                            args:
                            - Ident:
                              - track_id
                              span: 1:601-609
                          span: 1:596-609
                          alias: last_val
                        span: 1:528-614
                    span: 1:521-614
                  - FuncCall:
                      name:
                        Ident:
                        - take
                        span: 1:617-621
                      args:
                      - Literal:
                          Integer: 10
                        span: 1:622-624
                    span: 1:617-624
                span: 1:501-624
            span: 1:482-626
          - FuncCall:
              name:
                Ident:
                - sort
                span: 1:627-631
              args:
              - Tuple:
                - Ident:
                  - genre_id
                  span: 1:633-641
                - Ident:
                  - milliseconds
                  span: 1:643-655
                span: 1:632-656
            span: 1:627-656
          - FuncCall:
              name:
                Ident:
                - select
                span: 1:657-663
              args:
              - Tuple:
                - Ident:
                  - track_id
                  span: 1:665-673
                - Ident:
                  - genre_id
                  span: 1:675-683
                - Ident:
                  - num
                  span: 1:685-688
                - Ident:
                  - total
                  span: 1:690-695
                - Ident:
                  - last_val
                  span: 1:697-705
                span: 1:664-706
            span: 1:657-706
          - FuncCall:
              name:
                Ident:
                - filter
                span: 1:707-713
              args:
              - Binary:
                  left:
                    Ident:
                    - genre_id
                    span: 1:714-722
                  op: Gte
                  right:
                    Literal:
                      Integer: 22
                    span: 1:726-728
                span: 1:714-728
            span: 1:707-728
        span: 1:470-728
    span: 1:0-728
