---
source: prqlc/prqlc/tests/integration/queries.rs
expression: "# mssql:test\nfrom tracks\nderive d = (album_id + 1 | as REAL)\ngroup d (\n    aggregate {\n        n1 = (track_id | sum | as REAL),\n    }\n)\nsort d\ntake 10\nselect { d1 = d, n1 }\n"
input_file: prqlc/prqlc/tests/integration/queries/group_sort.prql
---
frames:
- - 1:25-60
  - columns:
    - !All
      input_id: 130
      except: []
    - !Single
      name:
      - d
      target_id: 132
      target_name: null
    inputs:
    - id: 130
      name: tracks
      table:
      - default_db
      - tracks
- - 1:75-133
  - columns:
    - !Single
      name:
      - d
      target_id: 141
      target_name: null
    - !Single
      name:
      - n1
      target_id: 158
      target_name: null
    inputs:
    - id: 130
      name: tracks
      table:
      - default_db
      - tracks
- - 1:136-142
  - columns:
    - !Single
      name:
      - d
      target_id: 141
      target_name: null
    - !Single
      name:
      - n1
      target_id: 158
      target_name: null
    inputs:
    - id: 130
      name: tracks
      table:
      - default_db
      - tracks
- - 1:143-150
  - columns:
    - !Single
      name:
      - d
      target_id: 141
      target_name: null
    - !Single
      name:
      - n1
      target_id: 158
      target_name: null
    inputs:
    - id: 130
      name: tracks
      table:
      - default_db
      - tracks
- - 1:151-172
  - columns:
    - !Single
      name:
      - d1
      target_id: 174
      target_name: null
    - !Single
      name:
      - n1
      target_id: 175
      target_name: null
    inputs:
    - id: 130
      name: tracks
      table:
      - default_db
      - tracks
nodes:
- id: 130
  kind: Ident
  span: 1:13-24
  ident: !Ident
  - default_db
  - tracks
  parent: 140
- id: 132
  kind: RqOperator
  span: 1:52-59
  alias: d
  targets:
  - 135
  parent: 139
- id: 135
  kind: RqOperator
  span: 1:37-49
  targets:
  - 137
  - 138
- id: 137
  kind: Ident
  span: 1:37-45
  ident: !Ident
  - this
  - tracks
  - album_id
  targets:
  - 130
- id: 138
  kind: Literal
  span: 1:48-49
- id: 139
  kind: Tuple
  span: 1:52-59
  children:
  - 132
  parent: 140
- id: 140
  kind: 'TransformCall: Derive'
  span: 1:25-60
  children:
  - 130
  - 139
  parent: 165
- id: 141
  kind: Ident
  span: 1:67-68
  ident: !Ident
  - this
  - d
  targets:
  - 132
  parent: 144
- id: 144
  kind: Tuple
  span: 1:67-68
  children:
  - 141
  parent: 165
- id: 158
  kind: RqOperator
  span: 1:118-125
  alias: n1
  targets:
  - 161
  parent: 164
- id: 161
  kind: RqOperator
  span: 1:112-115
  targets:
  - 163
- id: 163
  kind: Ident
  span: 1:101-109
  ident: !Ident
  - this
  - tracks
  - track_id
  targets:
  - 130
- id: 164
  kind: Tuple
  span: 1:85-133
  children:
  - 158
  parent: 165
- id: 165
  kind: 'TransformCall: Aggregate'
  span: 1:75-133
  children:
  - 140
  - 164
  - 144
  parent: 170
- id: 168
  kind: Ident
  span: 1:141-142
  ident: !Ident
  - this
  - d
  targets:
  - 141
  parent: 170
- id: 170
  kind: 'TransformCall: Sort'
  span: 1:136-142
  children:
  - 165
  - 168
  parent: 172
- id: 172
  kind: 'TransformCall: Take'
  span: 1:143-150
  children:
  - 170
  - 173
  parent: 177
- id: 173
  kind: Literal
  parent: 172
- id: 174
  kind: Ident
  span: 1:165-166
  alias: d1
  ident: !Ident
  - this
  - d
  targets:
  - 141
  parent: 176
- id: 175
  kind: Ident
  span: 1:168-170
  ident: !Ident
  - this
  - n1
  targets:
  - 158
  parent: 176
- id: 176
  kind: Tuple
  span: 1:158-172
  children:
  - 174
  - 175
  parent: 177
- id: 177
  kind: 'TransformCall: Select'
  span: 1:151-172
  children:
  - 172
  - 176
ast:
  name: Project
  stmts:
  - VarDef:
      kind: Main
      name: main
      value:
        Pipeline:
          exprs:
          - FuncCall:
              name:
                Ident: from
                span: 1:13-17
              args:
              - Ident: tracks
                span: 1:18-24
            span: 1:13-24
          - FuncCall:
              name:
                Ident: derive
                span: 1:25-31
              args:
              - Pipeline:
                  exprs:
                  - Binary:
                      left:
                        Ident: album_id
                        span: 1:37-45
                      op: Add
                      right:
                        Literal:
                          Integer: 1
                        span: 1:48-49
                    span: 1:37-49
                  - FuncCall:
                      name:
                        Ident: as
                        span: 1:52-54
                      args:
                      - Ident: REAL
                        span: 1:55-59
                    span: 1:52-59
                span: 1:37-59
                alias: d
            span: 1:25-60
          - FuncCall:
              name:
                Ident: group
                span: 1:61-66
              args:
              - Ident: d
                span: 1:67-68
              - FuncCall:
                  name:
                    Ident: aggregate
                    span: 1:75-84
                  args:
                  - Tuple:
                    - Pipeline:
                        exprs:
                        - Ident: track_id
                          span: 1:101-109
                        - Ident: sum
                          span: 1:112-115
                        - FuncCall:
                            name:
                              Ident: as
                              span: 1:118-120
                            args:
                            - Ident: REAL
                              span: 1:121-125
                          span: 1:118-125
                      span: 1:100-126
                      alias: n1
                    span: 1:85-133
                span: 1:75-133
            span: 1:61-135
          - FuncCall:
              name:
                Ident: sort
                span: 1:136-140
              args:
              - Ident: d
                span: 1:141-142
            span: 1:136-142
          - FuncCall:
              name:
                Ident: take
                span: 1:143-147
              args:
              - Literal:
                  Integer: 10
                span: 1:148-150
            span: 1:143-150
          - FuncCall:
              name:
                Ident: select
                span: 1:151-157
              args:
              - Tuple:
                - Ident: d
                  span: 1:165-166
                  alias: d1
                - Ident: n1
                  span: 1:168-170
                span: 1:158-172
            span: 1:151-172
        span: 1:13-172
    span: 1:0-172
