---
source: prqlc/prqlc/tests/integration/queries.rs
expression: "# mssql:test\n# glaredb:skip â€” TODO: started raising an error on 2024-05-20; see `window.prql`\n# for more details\nfrom albums\nselect {\n    title,\n    title_and_spaces = f\"  {title}  \",\n    low = (title | text.lower),\n    up = (title | text.upper),\n    ltrimmed = (title | text.ltrim),\n    rtrimmed = (title | text.rtrim),\n    trimmed = (title | text.trim),\n    len = (title | text.length),\n    subs = (title | text.extract 2 5),\n    replace = (title | text.replace \"al\" \"PIKA\"),\n}\nsort {title}\nfilter (title | text.starts_with \"Black\") || (title | text.contains \"Sabbath\") || (title | text.ends_with \"os\")\n"
input_file: prqlc/prqlc/tests/integration/queries/text_module.prql
---
frames:
- - 1:127-481
  - columns:
    - !Single
      name:
      - albums
      - title
      target_id: 123
      target_name: null
    - !Single
      name:
      - title_and_spaces
      target_id: 124
      target_name: null
    - !Single
      name:
      - low
      target_id: 126
      target_name: null
    - !Single
      name:
      - up
      target_id: 129
      target_name: null
    - !Single
      name:
      - ltrimmed
      target_id: 132
      target_name: null
    - !Single
      name:
      - rtrimmed
      target_id: 135
      target_name: null
    - !Single
      name:
      - trimmed
      target_id: 138
      target_name: null
    - !Single
      name:
      - len
      target_id: 141
      target_name: null
    - !Single
      name:
      - subs
      target_id: 144
      target_name: null
    - !Single
      name:
      - replace
      target_id: 150
      target_name: null
    inputs:
    - id: 121
      name: albums
      table:
      - default_db
      - albums
- - 1:482-494
  - columns:
    - !Single
      name:
      - albums
      - title
      target_id: 123
      target_name: null
    - !Single
      name:
      - title_and_spaces
      target_id: 124
      target_name: null
    - !Single
      name:
      - low
      target_id: 126
      target_name: null
    - !Single
      name:
      - up
      target_id: 129
      target_name: null
    - !Single
      name:
      - ltrimmed
      target_id: 132
      target_name: null
    - !Single
      name:
      - rtrimmed
      target_id: 135
      target_name: null
    - !Single
      name:
      - trimmed
      target_id: 138
      target_name: null
    - !Single
      name:
      - len
      target_id: 141
      target_name: null
    - !Single
      name:
      - subs
      target_id: 144
      target_name: null
    - !Single
      name:
      - replace
      target_id: 150
      target_name: null
    inputs:
    - id: 121
      name: albums
      table:
      - default_db
      - albums
- - 1:495-606
  - columns:
    - !Single
      name:
      - albums
      - title
      target_id: 123
      target_name: null
    - !Single
      name:
      - title_and_spaces
      target_id: 124
      target_name: null
    - !Single
      name:
      - low
      target_id: 126
      target_name: null
    - !Single
      name:
      - up
      target_id: 129
      target_name: null
    - !Single
      name:
      - ltrimmed
      target_id: 132
      target_name: null
    - !Single
      name:
      - rtrimmed
      target_id: 135
      target_name: null
    - !Single
      name:
      - trimmed
      target_id: 138
      target_name: null
    - !Single
      name:
      - len
      target_id: 141
      target_name: null
    - !Single
      name:
      - subs
      target_id: 144
      target_name: null
    - !Single
      name:
      - replace
      target_id: 150
      target_name: null
    inputs:
    - id: 121
      name: albums
      table:
      - default_db
      - albums
nodes:
- id: 121
  kind: Ident
  span: 1:115-126
  ident: !Ident
  - default_db
  - albums
  parent: 157
- id: 123
  kind: Ident
  span: 1:140-145
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
  parent: 156
- id: 124
  kind: FString
  span: 1:170-184
  alias: title_and_spaces
  targets:
  - 125
  parent: 156
- id: 125
  kind: Ident
  span: 1:175-180
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 126
  kind: RqOperator
  span: 1:205-215
  alias: low
  targets:
  - 128
  parent: 156
- id: 128
  kind: Ident
  span: 1:197-202
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 129
  kind: RqOperator
  span: 1:236-246
  alias: up
  targets:
  - 131
  parent: 156
- id: 131
  kind: Ident
  span: 1:228-233
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 132
  kind: RqOperator
  span: 1:273-283
  alias: ltrimmed
  targets:
  - 134
  parent: 156
- id: 134
  kind: Ident
  span: 1:265-270
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 135
  kind: RqOperator
  span: 1:310-320
  alias: rtrimmed
  targets:
  - 137
  parent: 156
- id: 137
  kind: Ident
  span: 1:302-307
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 138
  kind: RqOperator
  span: 1:346-355
  alias: trimmed
  targets:
  - 140
  parent: 156
- id: 140
  kind: Ident
  span: 1:338-343
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 141
  kind: RqOperator
  span: 1:377-388
  alias: len
  targets:
  - 143
  parent: 156
- id: 143
  kind: Ident
  span: 1:369-374
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 144
  kind: RqOperator
  span: 1:411-427
  alias: subs
  targets:
  - 147
  - 148
  - 149
  parent: 156
- id: 147
  kind: Literal
  span: 1:424-425
- id: 148
  kind: Literal
  span: 1:426-427
- id: 149
  kind: Ident
  span: 1:403-408
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 150
  kind: RqOperator
  span: 1:453-477
  alias: replace
  targets:
  - 153
  - 154
  - 155
  parent: 156
- id: 153
  kind: Literal
  span: 1:466-470
- id: 154
  kind: Literal
  span: 1:471-477
- id: 155
  kind: Ident
  span: 1:445-450
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 121
- id: 156
  kind: Tuple
  span: 1:134-481
  children:
  - 123
  - 124
  - 126
  - 129
  - 132
  - 135
  - 138
  - 141
  - 144
  - 150
  parent: 157
- id: 157
  kind: 'TransformCall: Select'
  span: 1:127-481
  children:
  - 121
  - 156
  parent: 160
- id: 158
  kind: Ident
  span: 1:488-493
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 123
  parent: 160
- id: 160
  kind: 'TransformCall: Sort'
  span: 1:482-494
  children:
  - 157
  - 158
  parent: 180
- id: 161
  kind: RqOperator
  span: 1:502-606
  targets:
  - 163
  - 175
  parent: 180
- id: 163
  kind: RqOperator
  span: 1:502-573
  targets:
  - 165
  - 170
- id: 165
  kind: RqOperator
  span: 1:511-535
  targets:
  - 168
  - 169
- id: 168
  kind: Literal
  span: 1:528-535
- id: 169
  kind: Ident
  span: 1:503-508
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 123
- id: 170
  kind: RqOperator
  span: 1:549-572
  targets:
  - 173
  - 174
- id: 173
  kind: Literal
  span: 1:563-572
- id: 174
  kind: Ident
  span: 1:541-546
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 123
- id: 175
  kind: RqOperator
  span: 1:586-605
  targets:
  - 178
  - 179
- id: 178
  kind: Literal
  span: 1:601-605
- id: 179
  kind: Ident
  span: 1:578-583
  ident: !Ident
  - this
  - albums
  - title
  targets:
  - 123
- id: 180
  kind: 'TransformCall: Filter'
  span: 1:495-606
  children:
  - 160
  - 161
ast:
  name: Project
  stmts:
  - VarDef:
      kind: Main
      name: main
      value:
        Pipeline:
          exprs:
          - FuncCall:
              name:
                Ident:
                - from
                span: 1:115-119
              args:
              - Ident:
                - albums
                span: 1:120-126
            span: 1:115-126
          - FuncCall:
              name:
                Ident:
                - select
                span: 1:127-133
              args:
              - Tuple:
                - Ident:
                  - title
                  span: 1:140-145
                - FString:
                  - !String '  '
                  - !Expr
                    expr:
                      Ident:
                      - title
                      span: 1:175-180
                    format: null
                  - !String '  '
                  span: 1:170-184
                  alias: title_and_spaces
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:197-202
                    - Ident:
                      - text
                      - lower
                      span: 1:205-215
                  span: 1:196-216
                  alias: low
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:228-233
                    - Ident:
                      - text
                      - upper
                      span: 1:236-246
                  span: 1:227-247
                  alias: up
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:265-270
                    - Ident:
                      - text
                      - ltrim
                      span: 1:273-283
                  span: 1:264-284
                  alias: ltrimmed
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:302-307
                    - Ident:
                      - text
                      - rtrim
                      span: 1:310-320
                  span: 1:301-321
                  alias: rtrimmed
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:338-343
                    - Ident:
                      - text
                      - trim
                      span: 1:346-355
                  span: 1:337-356
                  alias: trimmed
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:369-374
                    - Ident:
                      - text
                      - length
                      span: 1:377-388
                  span: 1:368-389
                  alias: len
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:403-408
                    - FuncCall:
                        name:
                          Ident:
                          - text
                          - extract
                          span: 1:411-423
                        args:
                        - Literal:
                            Integer: 2
                          span: 1:424-425
                        - Literal:
                            Integer: 5
                          span: 1:426-427
                      span: 1:411-427
                  span: 1:402-428
                  alias: subs
                - Pipeline:
                    exprs:
                    - Ident:
                      - title
                      span: 1:445-450
                    - FuncCall:
                        name:
                          Ident:
                          - text
                          - replace
                          span: 1:453-465
                        args:
                        - Literal:
                            String: al
                          span: 1:466-470
                        - Literal:
                            String: PIKA
                          span: 1:471-477
                      span: 1:453-477
                  span: 1:444-478
                  alias: replace
                span: 1:134-481
            span: 1:127-481
          - FuncCall:
              name:
                Ident:
                - sort
                span: 1:482-486
              args:
              - Tuple:
                - Ident:
                  - title
                  span: 1:488-493
                span: 1:487-494
            span: 1:482-494
          - FuncCall:
              name:
                Ident:
                - filter
                span: 1:495-501
              args:
              - Binary:
                  left:
                    Binary:
                      left:
                        Pipeline:
                          exprs:
                          - Ident:
                            - title
                            span: 1:503-508
                          - FuncCall:
                              name:
                                Ident:
                                - text
                                - starts_with
                                span: 1:511-527
                              args:
                              - Literal:
                                  String: Black
                                span: 1:528-535
                            span: 1:511-535
                        span: 1:503-535
                      op: Or
                      right:
                        Pipeline:
                          exprs:
                          - Ident:
                            - title
                            span: 1:541-546
                          - FuncCall:
                              name:
                                Ident:
                                - text
                                - contains
                                span: 1:549-562
                              args:
                              - Literal:
                                  String: Sabbath
                                span: 1:563-572
                            span: 1:549-572
                        span: 1:541-572
                    span: 1:502-573
                  op: Or
                  right:
                    Pipeline:
                      exprs:
                      - Ident:
                        - title
                        span: 1:578-583
                      - FuncCall:
                          name:
                            Ident:
                            - text
                            - ends_with
                            span: 1:586-600
                          args:
                          - Literal:
                              String: os
                            span: 1:601-605
                        span: 1:586-605
                    span: 1:578-605
                span: 1:502-606
            span: 1:495-606
        span: 1:115-606
    span: 1:0-606
