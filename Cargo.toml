[workspace]
members = [
  "prql-compiler",
  "prql-macros",
  "prql-java",
  "prql-lib",
  "prql-js",
  "prql-python",
  "book",
]
# Note we don't have a `default-members = ["prql-compiler"]`, since that causes
# commands like `cargo test` to only run tests from the default package. And
# `cargo insta test` doesn't have a `--workspace` flag.

[profile.release.package.prql-js]
# Tell `rustc` to optimize for small code size.
opt-level = "s"

[workspace.package]
version = "0.2.11"

[workspace.metadata.release]
consolidate-commits = true
pre-release-commit-message = "chore: Release {{version}}"
shared-version = true

[[workspace.metadata.release.pre-release-replacements]]
exactly = 1
file = "prql-js/package.json"
replace = '  "version": "{{version}}"'
search = '  "version": "(\d+\.\d+\.\d+)"'

[[workspace.metadata.release.pre-release-replacements]]
exactly = 1
file = "playground/package-lock.json"
replace = '''    "../prql-js": {
      "version": "{{version}}"'''
search = '    "../prql-js": \{\n      "version": "[\d\.]+"'
