---
source: prql/src/parser.rs
expression: "parse_tree_of_str(r#\"\nfrom employees\nfilter country = \"USA\"                           # Each line transforms the previous result.\nderive [                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]\nfilter gross_cost > 0\naggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]\nsort sum_gross_cost\nfilter count > 200\ntake 20\n    \"#.trim(),\n                  Rule::pipeline)?"
---
[
    Pair {
        rule: pipeline,
        span: Span {
            str: "from employees\nfilter country = \"USA\"                           # Each line transforms the previous result.\nderive [                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]\nfilter gross_cost > 0\naggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]\nsort sum_gross_cost\nfilter count > 200\ntake 20",
            start: 0,
            end: 722,
        },
        inner: [
            Pair {
                rule: transformation,
                span: Span {
                    str: "from employees",
                    start: 0,
                    end: 14,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "from",
                            start: 0,
                            end: 4,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "employees",
                            start: 5,
                            end: 14,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "employees",
                                    start: 5,
                                    end: 14,
                                },
                                inner: [
                                    Pair {
                                        rule: ident,
                                        span: Span {
                                            str: "employees",
                                            start: 5,
                                            end: 14,
                                        },
                                        inner: [],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "filter country = \"USA\"",
                    start: 15,
                    end: 37,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "filter",
                            start: 15,
                            end: 21,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "country = \"USA\"",
                            start: 22,
                            end: 37,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "country = \"USA\"",
                                    start: 22,
                                    end: 37,
                                },
                                inner: [
                                    Pair {
                                        rule: ident,
                                        span: Span {
                                            str: "country",
                                            start: 22,
                                            end: 29,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: operator,
                                        span: Span {
                                            str: "=",
                                            start: 30,
                                            end: 31,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: string_literal,
                                        span: Span {
                                            str: "\"USA\"",
                                            start: 32,
                                            end: 37,
                                        },
                                        inner: [
                                            Pair {
                                                rule: string,
                                                span: Span {
                                                    str: "USA",
                                                    start: 33,
                                                    end: 36,
                                                },
                                                inner: [],
                                            },
                                        ],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "derive [                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]",
                    start: 108,
                    end: 316,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "derive",
                            start: 108,
                            end: 114,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "[                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]",
                            start: 115,
                            end: 316,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "[                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]",
                                    start: 115,
                                    end: 316,
                                },
                                inner: [
                                    Pair {
                                        rule: list,
                                        span: Span {
                                            str: "[                                         # This adds columns / variables.\n  gross_salary ~ salary + payroll_tax,\n  gross_cost   ~ gross_salary + benefits_cost    # Variables can use other variables.\n]",
                                            start: 115,
                                            end: 316,
                                        },
                                        inner: [
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "gross_salary ~ salary + payroll_tax",
                                                    start: 192,
                                                    end: 227,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "gross_salary",
                                                            start: 192,
                                                            end: 204,
                                                        },
                                                        inner: [],
                                                    },
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "salary + payroll_tax",
                                                            start: 207,
                                                            end: 227,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: ident,
                                                                span: Span {
                                                                    str: "salary",
                                                                    start: 207,
                                                                    end: 213,
                                                                },
                                                                inner: [],
                                                            },
                                                            Pair {
                                                                rule: operator,
                                                                span: Span {
                                                                    str: "+",
                                                                    start: 214,
                                                                    end: 215,
                                                                },
                                                                inner: [],
                                                            },
                                                            Pair {
                                                                rule: ident,
                                                                span: Span {
                                                                    str: "payroll_tax",
                                                                    start: 216,
                                                                    end: 227,
                                                                },
                                                                inner: [],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "gross_cost   ~ gross_salary + benefits_cost",
                                                    start: 231,
                                                    end: 274,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "gross_cost",
                                                            start: 231,
                                                            end: 241,
                                                        },
                                                        inner: [],
                                                    },
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "gross_salary + benefits_cost",
                                                            start: 246,
                                                            end: 274,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: ident,
                                                                span: Span {
                                                                    str: "gross_salary",
                                                                    start: 246,
                                                                    end: 258,
                                                                },
                                                                inner: [],
                                                            },
                                                            Pair {
                                                                rule: operator,
                                                                span: Span {
                                                                    str: "+",
                                                                    start: 259,
                                                                    end: 260,
                                                                },
                                                                inner: [],
                                                            },
                                                            Pair {
                                                                rule: ident,
                                                                span: Span {
                                                                    str: "benefits_cost",
                                                                    start: 261,
                                                                    end: 274,
                                                                },
                                                                inner: [],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "filter gross_cost > 0",
                    start: 317,
                    end: 338,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "filter",
                            start: 317,
                            end: 323,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "gross_cost > 0",
                            start: 324,
                            end: 338,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "gross_cost > 0",
                                    start: 324,
                                    end: 338,
                                },
                                inner: [
                                    Pair {
                                        rule: ident,
                                        span: Span {
                                            str: "gross_cost",
                                            start: 324,
                                            end: 334,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: operator,
                                        span: Span {
                                            str: ">",
                                            start: 335,
                                            end: 336,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: number,
                                        span: Span {
                                            str: "0",
                                            start: 337,
                                            end: 338,
                                        },
                                        inner: [],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "aggregate by:[title, country] [                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]",
                    start: 339,
                    end: 675,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "aggregate",
                            start: 339,
                            end: 348,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_arg,
                        span: Span {
                            str: "by:[title, country]",
                            start: 349,
                            end: 368,
                        },
                        inner: [
                            Pair {
                                rule: ident,
                                span: Span {
                                    str: "by",
                                    start: 349,
                                    end: 351,
                                },
                                inner: [],
                            },
                            Pair {
                                rule: list,
                                span: Span {
                                    str: "[title, country]",
                                    start: 352,
                                    end: 368,
                                },
                                inner: [
                                    Pair {
                                        rule: named_expr,
                                        span: Span {
                                            str: "title",
                                            start: 353,
                                            end: 358,
                                        },
                                        inner: [
                                            Pair {
                                                rule: expr,
                                                span: Span {
                                                    str: "title",
                                                    start: 353,
                                                    end: 358,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "title",
                                                            start: 353,
                                                            end: 358,
                                                        },
                                                        inner: [],
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                    Pair {
                                        rule: named_expr,
                                        span: Span {
                                            str: "country",
                                            start: 360,
                                            end: 367,
                                        },
                                        inner: [
                                            Pair {
                                                rule: expr,
                                                span: Span {
                                                    str: "country",
                                                    start: 360,
                                                    end: 367,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "country",
                                                            start: 360,
                                                            end: 367,
                                                        },
                                                        inner: [],
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                ],
                            },
                        ],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "[                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]",
                            start: 369,
                            end: 675,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "[                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]",
                                    start: 369,
                                    end: 675,
                                },
                                inner: [
                                    Pair {
                                        rule: list,
                                        span: Span {
                                            str: "[                  # `by` are the columns to group by.\n    average salary,                              # These are aggregation calcs run on each group.\n    sum     salary,\n    average gross_salary,\n    sum     gross_salary,\n    average gross_cost,\n    sum_gross_cost ~ sum gross_cost,\n    count ~ count,\n]",
                                            start: 369,
                                            end: 675,
                                        },
                                        inner: [
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "average salary",
                                                    start: 428,
                                                    end: 442,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "average salary",
                                                            start: 428,
                                                            end: 442,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "average salary",
                                                                    start: 428,
                                                                    end: 442,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "average",
                                                                            start: 428,
                                                                            end: 435,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "salary",
                                                                            start: 436,
                                                                            end: 442,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "sum     salary",
                                                    start: 526,
                                                    end: 540,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "sum     salary",
                                                            start: 526,
                                                            end: 540,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "sum     salary",
                                                                    start: 526,
                                                                    end: 540,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "sum",
                                                                            start: 526,
                                                                            end: 529,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "salary",
                                                                            start: 534,
                                                                            end: 540,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "average gross_salary",
                                                    start: 546,
                                                    end: 566,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "average gross_salary",
                                                            start: 546,
                                                            end: 566,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "average gross_salary",
                                                                    start: 546,
                                                                    end: 566,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "average",
                                                                            start: 546,
                                                                            end: 553,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "gross_salary",
                                                                            start: 554,
                                                                            end: 566,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "sum     gross_salary",
                                                    start: 572,
                                                    end: 592,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "sum     gross_salary",
                                                            start: 572,
                                                            end: 592,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "sum     gross_salary",
                                                                    start: 572,
                                                                    end: 592,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "sum",
                                                                            start: 572,
                                                                            end: 575,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "gross_salary",
                                                                            start: 580,
                                                                            end: 592,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "average gross_cost",
                                                    start: 598,
                                                    end: 616,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "average gross_cost",
                                                            start: 598,
                                                            end: 616,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "average gross_cost",
                                                                    start: 598,
                                                                    end: 616,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "average",
                                                                            start: 598,
                                                                            end: 605,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "gross_cost",
                                                                            start: 606,
                                                                            end: 616,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "sum_gross_cost ~ sum gross_cost",
                                                    start: 622,
                                                    end: 653,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "sum_gross_cost",
                                                            start: 622,
                                                            end: 636,
                                                        },
                                                        inner: [],
                                                    },
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "sum gross_cost",
                                                            start: 639,
                                                            end: 653,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: func_call,
                                                                span: Span {
                                                                    str: "sum gross_cost",
                                                                    start: 639,
                                                                    end: 653,
                                                                },
                                                                inner: [
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "sum",
                                                                            start: 639,
                                                                            end: 642,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                    Pair {
                                                                        rule: ident,
                                                                        span: Span {
                                                                            str: "gross_cost",
                                                                            start: 643,
                                                                            end: 653,
                                                                        },
                                                                        inner: [],
                                                                    },
                                                                ],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                            Pair {
                                                rule: named_expr,
                                                span: Span {
                                                    str: "count ~ count",
                                                    start: 659,
                                                    end: 672,
                                                },
                                                inner: [
                                                    Pair {
                                                        rule: ident,
                                                        span: Span {
                                                            str: "count",
                                                            start: 659,
                                                            end: 664,
                                                        },
                                                        inner: [],
                                                    },
                                                    Pair {
                                                        rule: expr,
                                                        span: Span {
                                                            str: "count",
                                                            start: 667,
                                                            end: 672,
                                                        },
                                                        inner: [
                                                            Pair {
                                                                rule: ident,
                                                                span: Span {
                                                                    str: "count",
                                                                    start: 667,
                                                                    end: 672,
                                                                },
                                                                inner: [],
                                                            },
                                                        ],
                                                    },
                                                ],
                                            },
                                        ],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "sort sum_gross_cost",
                    start: 676,
                    end: 695,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "sort",
                            start: 676,
                            end: 680,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "sum_gross_cost",
                            start: 681,
                            end: 695,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "sum_gross_cost",
                                    start: 681,
                                    end: 695,
                                },
                                inner: [
                                    Pair {
                                        rule: ident,
                                        span: Span {
                                            str: "sum_gross_cost",
                                            start: 681,
                                            end: 695,
                                        },
                                        inner: [],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "filter count > 200",
                    start: 696,
                    end: 714,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "filter",
                            start: 696,
                            end: 702,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "count > 200",
                            start: 703,
                            end: 714,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "count > 200",
                                    start: 703,
                                    end: 714,
                                },
                                inner: [
                                    Pair {
                                        rule: ident,
                                        span: Span {
                                            str: "count",
                                            start: 703,
                                            end: 708,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: operator,
                                        span: Span {
                                            str: ">",
                                            start: 709,
                                            end: 710,
                                        },
                                        inner: [],
                                    },
                                    Pair {
                                        rule: number,
                                        span: Span {
                                            str: "200",
                                            start: 711,
                                            end: 714,
                                        },
                                        inner: [],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
            Pair {
                rule: transformation,
                span: Span {
                    str: "take 20",
                    start: 715,
                    end: 722,
                },
                inner: [
                    Pair {
                        rule: ident,
                        span: Span {
                            str: "take",
                            start: 715,
                            end: 719,
                        },
                        inner: [],
                    },
                    Pair {
                        rule: named_expr_simple,
                        span: Span {
                            str: "20",
                            start: 720,
                            end: 722,
                        },
                        inner: [
                            Pair {
                                rule: expr_simple,
                                span: Span {
                                    str: "20",
                                    start: 720,
                                    end: 722,
                                },
                                inner: [
                                    Pair {
                                        rule: number,
                                        span: Span {
                                            str: "20",
                                            start: 720,
                                            end: 722,
                                        },
                                        inner: [],
                                    },
                                ],
                            },
                        ],
                    },
                ],
            },
        ],
    },
]
